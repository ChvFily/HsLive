<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
 	<title>视频回放</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  	<!-- add @yuxuhang  2021/04/26 -->
  	
  	<style type="text/css">
	/*  提示div的样式  */
	#suggest {
	    width:100px;
	    border:1px solid black;
	    font-size:14px;
	}
	 
	/* 提示信息鼠标覆盖时信息 */
	div.over {
	    border:1px solid #999;
	    background:#FFFFCC;
	    cursor:hand;
	}
	 
	/* 提示信息鼠标移出时信息 */
	div.out {
	    border: 1px solid #FFFFFF;
	    background:#FFFFFF;
	}
	</style>
	
	<!-- end @yuxuhang  2021/04/26 -->
 
  </head>
  <body style="background: #f5f5f5;" οnlοad="readInfo()">  
  <!-- add @yuxuhang -- onload() 表示 页面加载完后 执行该函数 -->
  	<div th:replace="fragment/header"></div>
	<div class="conten-main" >	 
	    <!-- 循环播放页面的内容 -->
		<div class="container px-1">
			<!-- @yuxuhang  2021/04/26 start 添加检索功能 -->
			<div style="margin: 20px auto;padding-top:20px;">
				<p style="display:inline;font-size:24px;" class="mt-3 mb-0"><a href="/pageVideo" style="text-decoration: none;color:#303030;">全部视频</a></p>
				<div  style="float: right;"> <!-- 右浮动 -->
					<input type="text" name="info" id="info" style="width: 261px;" onkeyup="resetReading()">
					<input type="button" value="搜索" onclick="showInfo()">
					<div id="suggest" style="display:none;position:relative;width:260px"></div>
				</div>
			</div>
			<!-- 清除浮动 -->
			<div class="clear-float-1" style="clear:both"></div>
			<!-- @yuxuahng 2021/04/26 end -->
		  
		  <div id="show-v" class="row row-cols-2 row-cols-md-3 row-cols-lg-4" 	>
		    <div class="col my-3 " th:each="v:${page.records}"> <!-- page.records 一页记录（一组数据） -->
		    	<div class="bg-white pb-2">
			    <a th:href="@{'/details/'+${v.id}}" class="text-dark" target="_blank" >
					<img src="/res/dist/img/default_video.jpg" width="100%">	
					<span class="ml-2" th:text="${v.getSrsStream()}">标题</span>   
			    </a>
			    </div>
		    </div>
		  </div>
		</div>
		<div id = "show-p"  class="container px-1"  style="width:90px;height:54px">
			
			<div th:if="${page.total>0}" >
				<nav aria-label="Page navigation example">
				  <ul class="pagination justify-content-center">
				    <li class="page-item " th:classappend="${!page.hasPrevious}?'disabled' ">
				    	<a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current-1}" aria-label="Previous">
					        <span aria-hidden="true">&laquo;</span>
					     </a>
				    </li>
				    <li th:if="${page.current-3>0}" class="page-item">
				    	<a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current-3}" th:text="${page.current-3}">1</a></li>
				    <li th:if="${page.current-2>0}" class="page-item">
				    	<a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current-2}" th:text="${page.current-2}">1</a></li>
				    <li th:if="${page.hasPrevious}" class="page-item">
				    	<a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current-1}" th:text="${page.current-1}">1</a></li>
				    <li class="page-item active" aria-current="page">
					      <span class="page-link" th:text="${page.current}">2
					      </span>
					    </li>
				    <li th:if="${page.current+1<=totalPages}" class="page-item">
				    	<a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current+1}"  th:text="${page.current+1}">3</a></li>
				    <li th:if="${page.current+2<=totalPages}" class="page-item">
				    	<a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current+2}"  th:text="${page.current+2}">4</a></li>
				    <li th:if="${page.current+3<=totalPages}" class="page-item">
				    	<a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current+3}"  th:text="${page.current+3}">5</a></li>
				    <li class="page-item" th:classappend="${!page.hasNext}?'disabled' ">
				      <a class="page-link" th:href="'/pageVideo?pageIndex='+${page.current+1}" aria-label="Next">
				        <span aria-hidden="true">&raquo;</span>
				      </a>
				    </li>
				  </ul>
				</nav>
			</div>
			<div th:if="${page.total<=0}" class="container px-1 d-flex justify-content-center" style="margin-top: 30px;">
				<b>暂无数据</b>
			</div>
		</div>	
	</div>
	<!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <!--  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	 
	<script type="text/javascript">
	var xmlHttp; //全局 App 请求 数据
	var currentInfo="";
	var counter=1;
	var isReading = false;
	 
	function readInfo(){
		var info =document.getElementById("info").value; //文本  输入的信息
		if(currentInfo==info && info!=""){
			counter++;
			
		}else{
			currentInfo=info;
			counter=1;
			
		}
		if(counter==3){
			getSuggest(info);
			isReading=false;
			
		}else{
			setTimeout("readInfo()", 200);
		}
	}
	/**
	 * 更新搜索框 内容
	*/
	function resetReading(){
		// alert("输入变化了")
		if(!isReading){
			isReading=true;
			readInfo();  // 搜索内容
		}
	}
	
	function createXmlHttp(){
		if(window.XMLHttpRequest){
			xmlHttp = new XMLHttpRequest();
		}else{
			xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
	}
	
	function getSuggest(info){
		createXmlHttp(); //创建http 请求
		//xmlHttp.open("GET", "suggest.jsp?info="+encodeURI(info),true); // get 请求方式 ，请求该页面 important 可以修改为 / 当前目录
		xmlHttp.open("GET", "http://localhost:8085/testInfo?info="+info,true);  //  http://localhost:8085/testInfo?info=yuxuhang
		xmlHttp.onreadystatechange = showSuggest;  // 当页面属性改变 时 触发修改页面（）
		xmlHttp.send(null);   // 使用post 方式时 才会改变响应的 内容
	}
	function clearSuggest(){
		document.getElementById("suggest").innerHTML ="";
		
	}
	// show the  
	function createSuggest(text){
		var sDiv  = "<div class='out' onmouseover=\"this.className='over'\" onmouseout = \"this.className='out'\" onclick=\"setSuggest(this)\">"+text+"</div>";
		document.getElementById("suggest").innerHTML +=sDiv;
	}
	function displaySuggest(){
		document.getElementById("suggest").style.display="";
	}
	function hiddentSuggest(){
		document.getElementById("suggest").style.display="none";
	}
	/**
	 * 搜索框变动时，触发该函数 
	*/
	function showSuggest(){
		if(xmlHttp.readyState == 4){ // 如果状态为4 返回数据
			clearSuggest(); //清除数据
			var suggestsText = xmlHttp.responseText; // 返回的数据 如果是josin 
	
			if(suggestsText !=""){
				//suggestsText=JSON.parse(suggestsText);// @yuxuhang add  解析返回来的  json 数据
	
				// var suggests = suggestsText.split("|"); // 把获得的 数据以 “|” 分开
				// for (var i=0;i<suggests.length;i++){
				// 	createSuggest(suggests[i]);
				// }
				createSuggest(suggestsText);
				displaySuggest();  // 展示数据
			}else{
				hiddentSuggest();
			}
		}
	}
	function setSuggest(divObj){
		document.getElementById("info").value=divObj.innerHTML;
		hiddentSuggest();
	}
	function showInfo(){
		var name = document.getElementById("info").value;
		$('#show-v').load("/loadSeach_v?seachInfo="+name);
		$('#show-p').load("/loadSeach_p?seachInfo="+name);
	}
	
  	$(function(){
  		$('#pageVideo').addClass("active");
  	});
  	</script>
  </body>
</html>

